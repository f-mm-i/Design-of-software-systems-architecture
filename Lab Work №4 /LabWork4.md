# Лабораторная работа №4  
**Тема:** Проектирование REST API  
**Проект:** мобильное приложение для ментальных карт «Mental Maps»  
**Выбранный сервис системы, предоставляющий API:** **Backend API → Maps & Moderation Service** (serverless слой на Firebase Cloud Functions)

## Цель работы
Получить опыт проектирования программного интерфейса: определить проектные решения, описать REST API (GET/POST/PUT/DELETE), подготовить основу для реализации и тестирования (Postman).

---

## 1. Описание выбранного сервиса
### Зачем нужен Backend API в «Mental Maps»
Хотя Firebase предоставляет готовые сервисы (Auth/Firestore/Storage/Analytics), **Backend API** нужен для:
- централизованной **проверки прав доступа** (особенно для роли модератора);
- единообразной валидации данных и форматов;
- реализации бизнес-операций (создание/обновление карт, работа с жалобами и статусами);
- уменьшения “разрастания” логики на клиенте.

### Роли и доступ
- **Пользователь**: работает только со своими картами, может отправлять жалобы.
- **Модератор**: дополнительно может просматривать жалобы и менять статусы модерации.

---

## 2. Принятые проектные решения

1. **Ресурсный подход (REST):**  
   API проектируется вокруг ресурсов: `maps`, `elements`, `routes`, `reports` (жалобы), а не вокруг действий.  

2. **Версионирование по URL:**  
   Все маршруты имеют префикс: `/api/v1/...` — это упрощает дальнейшее развитие без ломания клиентов.

3. **Аутентификация через Bearer Token (Firebase ID token):**  
   Клиент передаёт `Authorization: Bearer <idToken>`. Backend проверяет токен через Firebase Admin SDK.

4. **Авторизация по ролям и владению (RBAC + ownership):**  
   - Пользователь может изменять только свои ресурсы.  
   - Модератор может управлять модерацией/жалобами.  
   Роль определяется через claims (например, `role=moderator`) или отдельное поле профиля.

5. **Единый формат обмена JSON:**  
   Ошибки возвращаются в стандартизированном JSON, чтобы клиент мог одинаково обрабатывать любые сбои.

6. **Использование стандартных HTTP-методов:**
   - `GET` — получение,
   - `POST` — создание,
   - `PUT` — полное обновление/замена,
   - `DELETE` — удаление.

7. **Идемпотентность `PUT` и `DELETE`:**  
   Повторный `PUT` с тем же телом должен приводить к тому же состоянию ресурса, `DELETE` повторно возвращает `204` или `404` (выбран единый вариант, см. ниже).

8. **Пагинация списков через `limit` + `cursor`:**  
   Для больших списков (например, карты пользователя) используются параметры `limit` и `cursor` (курсорная пагинация лучше подходит для NoSQL).

9. **Согласованный нейминг и структура данных:**  
   - идентификаторы: `mapId`, `elementId`, `reportId`;  
   - поля — `snake_case` внутри БД, но в API — `camelCase` (или наоборот).  
   В данном API фиксируем **camelCase** в запросах/ответах.

10. **Явная поддержка публичности карт:**  
   Карта может быть `visibility: "private" | "public"`. Публичные карты видимы всем, но изменяемы только владельцем/модератором (по правилам).
---

## 3. Общие правила API

### 3.1 Base URL
- Локально (пример): `http://localhost:3000/api/v1`
- После деплоя (пример): `https://<your-cloud-functions-domain>/api/v1`

### 3.2 Заголовки
Обязательные:
- `Content-Type: application/json` (для POST/PUT)
- `Authorization: Bearer <Firebase ID token>` (для защищённых методов)

### 3.3 Формат данных
- Все запросы/ответы: **JSON**
- Даты: ISO 8601 (`2026-02-01T12:34:56Z`)

### 3.4 Единый формат ошибок
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Некорректные параметры запроса",
    "details": [
      { "field": "title", "issue": "required" }
    ]
  }
}
```

### 3.5 Типовые HTTP-коды
- `200 OK` — успешный запрос (GET/PUT)
- `201 Created` — успешное создание (POST)
- `204 No Content` — успешное удаление (DELETE)
- `400 Bad Request` — ошибка валидации/параметров
- `401 Unauthorized` — нет/неверный токен
- `403 Forbidden` — нет прав (роль/владелец)
- `404 Not Found` — ресурс не найден
- `409 Conflict` — конфликт состояния (например, попытка создать дубликат)
- `500 Internal Server Error` — непредвиденная ошибка

---

